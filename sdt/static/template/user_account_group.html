<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>账户合并</title>    <!--<link rel="stylesheet" href="../semantic/semantic.min.css">-->    <link rel="stylesheet" href="{% static 'semantic/semantic.css'%}">    <script src="https://code.jquery.com/jquery-1.12.4.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="sidebar" ></div><div class="dimmed pusher"><div class="ui labeled icon button" id="menu">		<i class="sidebar icon"></i>		导航		</div>    <div class="ui doubling stackable container" style="padding: 50px">        <div class="ui five item inverted menu">		<a class="item" id="a">出纳台</a>		<a class="item" id="b">玩家管理</a>		<a class="item" id="c">牌局管理</a>		<a class="item" id="d">实时报表</a>		<a class="item" id="e">俱乐部管理</a>		</div>        <div class="ui two stackable relaxed grid">            <div class="eight wide column" name="main_account" id="main_account">                <div class="ui form" name="user_info" id="user_info" method="post">            <label for="user_list">搜索玩家</label>        <select class="ui search selection dropdown" name="o_user_list" id="o_user_list" onchange="search()">            <i class="search link icon"></i>            <option class="item" value="">点击搜索</option>            {% for t in tb_user %}            <option class="item" value={{ t.0 }},{{ t.1 }}>{{ t.2 }}</option>            {% endfor %}        </select>            <h4 class="ui dividing pink header">主账户玩家信息</h4>            <div class="two fields">                <div class="field">                    <label>游戏名称</label>                <input type="text" name="o_user_name" id="o_user_name" readonly="true">                </div>            </div>            <div class="two fields">                <div class="field">                    <label>主账户</label>                <input type="text" name="o_main_account" id="o_main_account" readonly="true" >                </div>                    <div class="field">                    <label>同账户玩家</label>                <input type="text" name="o_account_list" id="o_account_list" readonly="true">                </div>            </div>            <div class="four fields">                <div class="field">                <label>余额</label>                <input type="text" name="o_balance" id="o_balance"  readonly="true">                </div>                <div class="field">                <label>信用额度</label>                <input type="text" name="o_credit" id="o_credit" readonly="true" value="">                </div>                <div class="field">                <label>预占用额度</label>                <input type="text" name="o_freeze" id="o_freeze" readonly="true" value="">                </div>                <div class="field">                <label>可用额度</label>                <input type="text" name="o_usef_balance" id="o_useful_balance"  readonly="true" value="">                </div>            </div>                <div class="field">                    <label>可结算</label>                    <input type="text" name="o_cashout_balance" id="o_cashout_balance"  readonly="true" value="">                </div>            </div>            <div class="ui hidden divider"></div>            <button class="ui button primary" onclick="migrate()">合并</button>            <button class="ui button negative">放弃</button>        </div>            <div class="eight wide column" name="target_account" id="target_account">        <div class="ui form" name="t_user_info" id="t_user_info" method="post">            <label for="t_user_list">搜索玩家</label>        <select class="ui search selection dropdown" name="t_user_list" id="t_user_list" onchange="search_target()">            <i class="search link icon"></i>            <option class="item" value="">点击搜索</option>            {% for t in tb_user %}            <option class="item" value={{ t.0 }},{{ t.1 }}>{{ t.2 }}</option>            {% endfor %}        </select>                      <h4 class="ui dividing green header">目标账户玩家信息</h4>            <div class="two fields">                <div class="field">                    <label>游戏名称</label>                <input type="text" name="t_user_name" id="t_user_name" readonly="true">                </div>            </div>            <div class="two fields">                <div class="field">                    <label>主账户</label>                <input type="text" name="t_main_account" id="t_main_account" readonly="true" >                </div>                    <div class="field">                    <label>同账户玩家</label>                <input type="text" name="t_account_list" id="t_account_list" readonly="true">                </div>            </div>            <div class="four fields">                <div class="field">                <label>余额</label>                <input type="text" name="t_balance" id="t_balance"  readonly="true" >                </div>                <div class="field">                <label>信用额度</label>                <input type="text" name="t_credit" id="t_credit" readonly="true" value="">                </div>                <div class="field">                <label>预占用额度</label>                <input type="text" name="t_freeze" id="t_freeze" readonly="true" value="">                </div>                <div class="field">                <label>可用额度</label>                <input type="text" name="t_usef_balance" id="t_useful_balance"  readonly="true" value="">                </div>            </div>                <div class="field">                    <label>可结算</label>                    <input type="text" name="t_cashout_balance" id="t_cashout_balance"  readonly="true" value="">                </div>        </div>        </div>            </div>        <div class="ui small modal">        <h2 class="header">处理结果</h2>        <div class="content">            <p id="msg1"></p>        </div>        <div class="actions">            <button class="ui negative button" onclick="messageconfirm()">返回</button>        </div>        </div>        <div class="ui info message">            <div class="header">操作提示</div>            <ul class="list"></ul>                <li>被合并账户不能信用额度</li>                <li>被合并账户不能有预占用金额</li>                <li>合并后被合并账户原账户流水将不能被查询，请提前保存</li>        </div>            </div>        </div>    </div></div><script>    $(document).ready(function () {        $('.ui.dropdown').dropdown();		$("#sidebar").load("{% static 'template/sidebar.html'%}");        $("#b").addClass('active red item');        $("#menu").click(function(){		    $('.ui.sidebar').sidebar('toggle')});    })</script><script>        function search() {            var struserinfo=$("#o_user_list").dropdown('get value');            var str_info=struserinfo.split(",");            var user_id=str_info[0];            var account_id=str_info[1];        var seacrh_name = $('#o_user_list').dropdown('get text');        $.ajax({            url : '/user_group_search/',            type : 'post',            datatype: "json",            data:{'account_id': account_id},            success:function (result) {                if(result!="False")                {                    var dic=[];                    $.each(JSON.parse(result), function (key, value) {                        dic[key]=value;                    })                    $('#o_user_name').val(seacrh_name);                    $('#o_wx_name').val(dic['wx_name']);                    $('#o_main_account').val(dic['main_account']);                    $('#o_account_list').val(dic['tb_account_list']);                    $('#o_credit').val(dic['credit_num']);                    $('#o_balance').val(dic['account_balance']);                    $('#o_freeze').val(dic['freeze_num']);                    $('#o_usef_balance').val(dic['balance_useful'])                    $('#o_cashout_balance').val(dic['balance_cashout'])                }            }        })    }        function search_target() {            var struserinfo=$("#t_user_list").dropdown('get value');            var str_info=struserinfo.split(",");            var user_id=str_info[0];            var account_id=str_info[1];            var seacrh_name = $('#t_user_list').dropdown('get text');        $.ajax({            url : '/user_group_search/',            type : 'post',            datatype: "json",            data:{'account_id': account_id},            success:function (result) {                if(result!="False")                {                    var dic=[];                    $.each(JSON.parse(result), function (key, value) {                        dic[key]=value;                    })                    $('#t_user_name').val(seacrh_name);                    $('#t_wx_name').val(dic['wx_name']);                    $('#t_main_account').val(dic['main_account']);                    $('#t_account_list').val(dic['tb_account_list']);                    $('#t_credit').val(dic['credit_num']);                    $('#t_balance').val(dic['account_balance']);                    $('#t_freeze').val(dic['freeze_num']);                    $('#t_usef_balance').val(dic['balance_useful']);                    $('#t_cashout_balance').val(dic['balance_cashout'])                }            }        })    }</script><script>    function migrate() {            var struserinfo=$("#t_user_list").dropdown('get value');            var struserinfo_2=$("#o_user_list").dropdown('get value');            if (struserinfo!=null && struserinfo_2 != null)            {                var str_info=struserinfo.split(",");                var t_user_id=str_info[0];                var t_account_id=str_info[1];                var str_info_2=struserinfo_2.split(",");                var o_account_id=str_info_2[1];                var t_credit=$('#t_credit').val();                var t_freeze=$('#t_freeze').val();                var t_account_name=$('#t_main_account').val();                if (t_account_id==o_account_id)                {                    $('#msg1').text("同账户不能合并");                    $('.ui.modal').modal('show');                }                else if ((Number(t_credit)+Number(t_freeze))>0)                {                    $('#msg1').text("有信用额度或仍有预占用额度账户不能被合并，请解除后再操作");                    $('.ui.modal').modal('show');                }                else {                    $.ajax({                        url: "/account_migrate/",                        type: 'post',                        data: {'o_account_id': o_account_id, 't_account_id': t_account_id, 't_user_id': t_user_id,'t_account_name': t_account_name},                        success: function (result) {                            if (result == 'True') {                                $('#msg1').text("合并成功");                                $('.ui.modal').modal('show');                            }                            if (result == 'False') {                                $('#msg1').text("合并成功");                                $('.ui.modal').modal('show');                            }                        }                    })                }            }    }    function messageconfirm() {            location.reload();        }</script></body></html>