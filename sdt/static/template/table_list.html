<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>牌局管理</title>    <!--<link rel="stylesheet" href="../semantic/semantic.min.css">-->    <link rel="stylesheet" href="{% static 'semantic/semantic.css'%}"><script src="http://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script><script src="http://lib.baomitu.com/datatables/1.10.16/js/jquery.dataTables.min.js"></script><script src="http://lib.baomitu.com/datatables/1.10.16/js/dataTables.semanticui.min.js"></script><script src="http://lib.baomitu.com/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="sidebar" ></div><div class="dimmed pusher"><div class="ui labeled icon button" id="menu">		<i class="sidebar icon"></i>		导航    </div><div class="ui doubling stackable container" style="padding: 50px"><div class="ui five item inverted menu">		<a class="item" id="a">出纳台</a>		<a class="item" id="b">玩家管理</a>		<a class="item" id="c">牌局管理</a>		<a class="item" id="d">实时报表</a>		<a class="item" id="e">俱乐部管理</a>		</div>        <div class="ui horizontal divider">	    牌局管理	    </div><div id="content">    <table class="ui  small celled stackable striped  table">        <thead>            <tr>                <th>编号</th>                <th>游戏</th>                <th>盲注</th>                <th>straddle</th>                <th>开始时间</th>                <th>时长</th>                <th>状态</th>                <th>开局客服</th>                <th>操作</th>            </tr>        </thead>        <tbody>            {% for t in table_list %}            <tr>                <td>{{ t.0 }}</td>                <td>{{ t.1 }}</td>                <td>{{ t.2 }}</td>                <td>{{ t.3 }}</td>                <td>{{ t.4 }}</td>                <td>{{ t.5 }}</td>                <td>{{ t.6 }}</td>                <td>{{ t.7 }}</td>                <td><div class="ui dropdown icon item">                    <i class="wrench icon"></i>                        <div class="menu">                        <div class="item" name="buy_in">带入</div>                        {% if permission_flag %}                        <div class="item" name="finish">结束</div>                        {% endif %}                        <div class="item" name="reward">奖励</div>                        {% if permission_flag %}                        <div class="item" name="abort">作废</div>                        {% endif %}                        </div>                    </div>                </td>              {% endfor %}            </tr>        </tbody>    </table>    <div class="ui scrolling  modal" id="buy" >        <h2 class="ui header">牌局编号</h2><label class="ui red ribbon label" id="game_no"></label>        <div class="scrolling content" id="buyin_reg">        </div>    </div>    <div class="ui small modal" id="message">        <h2 class="header">错误信息</h2>        <div class="content">            <p id="msg"></p>        </div>        <div class="actions">            <button class="ui negative button" onclick="reflesh()">返回</button>        </div>    </div>    <div class="ui modal" id="reward">        <h2 class="header">牌局奖励</h2>        <div class="content">        <div class="ui form" id="reward_form">            <div class="field">                <label>玩家</label>                <select class="ui selected dropdown" id="reward_user">                    <option value="">请选择玩家</option>                </select>            </div>            <div class="field">                <label>选择牌型</label>                <select class="ui selected dropdown" id="rewardlist" onchange="setreward()">                    <option value="">选择牌型</option>                </select>            </div>            <div class="field">                <label>奖励标准</label>                <input type="text" readonly="readonly" id="reward_value" value="">            </div>            <div class="field">                <label>支出账户</label>                <select class="ui selected dropdown" id="accountlist">                    <option value="">选择支出账户</option>                </select>            </div>            <div class="field">                <div class="ui checked checkbox" >                    <input type="checkbox" id="user_flag" checked="">                    <label>充入玩家账户</label>                </div>            </div>        </div>        </div>        <div class="actions">            <button class="ui positive button" onclick="reward_reg()">确认</button>            <button class="ui negative button">返回</button>        </div>    </div></div></div></div><script>	$(document).ready(function(){	    $('.ui.dropdown').dropdown();		$("#menu").click(function(){		    $('.ui.sidebar').sidebar('toggle');	});		$("#sidebar").load('/loadsidebar/');        $("#c").addClass('active red item');        $.ajaxSetup ({ cache: false });	}					 );    $("div[name='buy_in']").click(function buy_in() {        $.ajaxSetup({async: true});        var msg=$(this).parents("tr").find("td").eq(0).text();        $('#game_no').text(msg)        $('#buyin_reg').load('/table_reg_mini/', {'gameno':msg},function (result) {            $('#buy').modal({            autofocus: false        });            if(result==='False')            {                $('#msg').text("该牌局已经导入，请刷新列表");                location.reload()            }            $('#buy').modal('show');        });    });    $("div[name=abort]").click(function () {        $.ajaxSetup({async: true});        var gameno=$(this).parents("tr").find("td").eq(0).text();        $.ajax({            url:"/abortgame/",            type: 'post',            data: {'game_no': gameno},            success: function (result) {                location.reload()            }        })    });    $("div[name=finish]").click(function () {        var gameno=$(this).parents("tr").find("td").eq(0).text();        $.ajax({            url:'/getGameStatus/',            type:'post',            data:{'game_no':gameno},            success: function (result) {                if (result==="True")                {                    var url="/result"+"?game_no="+gameno;                    window.open(url)                }                else {                    $('#msg').text("该牌局已经导入，请刷新列表");                    $('#message').modal('show');                }            }        })        //$(top.location).attr("href","/result/","_blank")    });    function reflesh() {        location.reload()    };    $("div[name=reward]").click(function () {         var game_no=$(this).parents("tr").find("td").eq(0).text();         $.ajax({             url:'/reward_normal_form/',             type:'post',             data:{'game_no': game_no},             datatype:'json',             success: function (result) {                 $('#reward_user').empty();                 $('#accountlist').empty();                 $('#rewardlist').empty();                 $('#reward_value').val("");                 if (result==='False')                 {                     alert('该牌局已经导入，请刷新列表');                     location.reload()                 }                 $.each(JSON.parse(result), function (key,value) {                     if (key==='user_list')                     {                         var tmp=value.toString();                         var userlist=tmp.split(",");                         var lenth=userlist.length;                         $('#reward_user').append('<option value="">请选择玩家</option>');                         for ( var t=0;t<lenth;t=t+3){                             var list='<option class="item" value='+ userlist[t] +','+userlist[t+1]+ '>' + userlist[t+2] + '</option>';                             $('#reward_user').append(list);                         }                     }                     if (key==='tb_reward')                     {                         var tmp=value.toString();                         var rewardlist=tmp.split(",");                         var lenth=rewardlist.length;                         $('#rewardlist').append('<option value="">选择牌型</option>')                         for ( var t=0;t<lenth;t=t+2){                             var list='<option class="item" value='+ rewardlist[t+1] + '>' + rewardlist[t] + '</option>';                             $('#rewardlist').append(list);                         }                     }                     if(key==='account_list')                     {                         var tmp=value.toString();                         var accountlist=tmp.split(",");                         var lenth=accountlist.length;                         for ( var t=0;t<lenth;t=t+2){                             var list='<option class="item" value='+ accountlist[t] + '>' + accountlist[t+1] + '</option>';                             $('#accountlist').append(list);                         }                     }                     $('#accountlist').find("option:contains('银行卡')").attr("selected",true);                     $('#reward').modal({                            autofocus: false                        });                     $('#reward').modal('show');                 })             }         })    })</script><script>    function setreward() {        var reward=$('#rewardlist').dropdown('get value');        $('#reward_value').val(parseFloat(reward/1000));    }    function reward_reg() {        var message=$("#reward_form").form('is valid');        if (message===true){        var user_flag=$('#user_flag').prop('checked');        var op_account_id=$('#accountlist').dropdown('get value');        var reward=$('#reward_value').val();        var struserinfo=$("#reward_user").dropdown('get value');        var user_info=struserinfo.split(",");        var user_id=user_info[0];        var account_id=user_info[1];        $.ajax({            url:'/reward_normal_reg/',            type:'post',            data:{'op_account_id':op_account_id, 'reward':reward,'user_flag': user_flag, 'user_id':user_id, 'user_account_id': account_id},            success: function (result) {                if (result==='True'){                    alert("操作成功")                }                else {                    alert("操作失败")                }            }        })    }    else{           alert("请填写正确信息")        }    }</script><script>$('#reward_form').form({    on:'blur',    inline : true,    fields:{        reward_value:{          identifier :'reward_value',          rules:[{              type: 'empty',              prompt: '请输入金额'          },{              type:'regExp',              value : '/^[1-9]\\d*(\\.\\d+)?$/',              prompt:'请输入正数'          }          ]        },        reward_user:{            identifier: 'reward_user',            rules:[{                type:'empty',                prompt:'请选择玩家'            }]        },        accountlist:{            identifier: 'accountlist',            rules:[{                type:'empty',                prompt:'请选择操作账户'            }]        }    }})</script></body></html>