<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>战绩清单</title>    <!--<link rel="stylesheet" href="../semantic/semantic.min.css"> -->    <link rel="stylesheet" href="{%static 'semantic/semantic.css' %} "><script src="http://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script><script src="http://lib.baomitu.com/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="content">    <table class="ui celled small blue table" id="result_table">        <thead>            <tr>                <th colspan="2">牌局编号：<span id="game_no">{{ game_no }}</span></th>                <th colspan="6" class="center aligned">原战绩</th>                <th colspan="5" class="center aligned">修改后战绩</th>            </tr>            <tr>                <th style="display: none">club_id</th>                <th style="display: none">id</th>                <th style="display: none">is_modify</th>                <th>玩家</th>                <th>俱乐部</th>                <th>原始战绩</th>                <th>原始保险</th>                <th>水钱</th>                <th>保险</th>                <th>上交水钱</th>                <th>上交保险</th>                <th>俱乐部</th>                <th>水钱</th>                <th>保险</th>                <th>上交水钱</th>                <th>上交保险</th>            </tr>        </thead>        <tbody>            {% for t in tb_result %}            <tr>                <td style="display: none">{{ t.0 }}</td>                <td style="display: none">{{ t.1 }}</td>                <td style="display: none">{{ t.2 }}</td>                <td>{{ t.3 }}</td>                <td>{{ t.4 }}</td>                <td>{{ t.5 }}</td>                <td>{{ t.6 }}</td>                <td>{{ t.7 }}</td>                <td>{{ t.8 }}</td>                <td>{{ t.9 }}</td>                <td>{{ t.10 }}</td>                <td>                    <select class="ui search selected dropdown" name="club">                        <option value="">请选择俱乐部</option>                        {% for b in tb_club %}                        <option value={{ b.club_id }},{{ b.income_rate }},{{ b.insure_rate }}>{{ b.club_name }}</option>                        {% endfor %}                    </select>                </td>                <td></td>                <td></td>                <td></td>                <td></td>            </tr>            {% endfor %}        </tbody>    </table>    <div class="ui small modal" id="check_modify" >        <i class="ui close icon"></i>        <h7 class="ui red icon header">            <i class="warning sign icon "></i>        </h7>        <div class="content">            <p id="warning_message"></p>        </div>        <div class="actions">            <div class="ui red basic cancel  button">            <i class="remove icon"></i>            取消            </div>            <button class="ui green ok button" onclick="modify()">            <i class="checkmark icon"></i>            确认            </button>        </div>    </div>    <button class="ui positive button" onclick="check_modify()">修改</button><script>    function set_modify() {        $('#result_table').find('tbody tr').each(function () {            var is_modify=$(this).find("td").eq(2).text();            if (is_modify==1)            {                $(this).addClass('negative');                $(this).css('text-decoration', 'line-through')                //$(this).find('td').find('tr').find('select[name=club]').attr('disabled','disabled')                $(this).find('td').eq(11).text('该记录无法被修改')            }        })    }</script><script>    $(document).ready(function () {        $('.ui.dropdown').dropdown({            fullTextSearch:true        });        set_modify()    })</script><script>    $('select[name=club]').change(function () {        var club_info=$(this).parents("tr").find("td").find('select').eq(0).dropdown('get value');        var new_club_name=$(this).parents("tr").find("td").find('select').eq(0).dropdown('get text');        var club_name=$(this).parents("tr").find("td").eq(4).text();        var income_obj=$(this).parents("tr").find("td").eq(12);        var insure_obj=$(this).parents("tr").find("td").eq(13);        var waterup_obj=$(this).parents("tr").find("td").eq(14);        var insureup_obj=$(this).parents("tr").find("td").eq(15);        var str_club_info=club_info.split(",");        var club_id=str_club_info[0];        var income_rate=str_club_info[1];        var insure_rate=str_club_info[2];        var score=$(this).parents("tr").find("td").eq(5).text();        var insure=$(this).parents("tr").find("td").eq(6).text();        var new_income=Math.abs(parseFloat(score))*0.025*parseFloat(income_rate)/100;        var new_insure=Math.abs(parseFloat(insure))*-0.975*parseFloat(insure_rate)/100;        var new_waterup=Math.abs(parseFloat(score))*0.025*(1-parseFloat(income_rate)/100);        var new_insureup=Math.abs(parseFloat(insure))*-0.975*(1-parseFloat(insure_rate)/100);        income_obj.text(new_income.toFixed(2));        insure_obj.text(new_insure.toFixed(2));        waterup_obj.text(new_waterup.toFixed(2));        insureup_obj.text(new_insureup.toFixed(2));        if (club_name !== new_club_name){            $(this).parents("tr").addClass('positive')        }        else {            $(this).parents("tr").removeClass('positive')        }    })</script><script>    function modify() {        var game_no=$('#game_no').text();        var result_list= new Array();        //var subs_result=new Array();        $('#result_table').find('tbody tr').each(function () {            var old_club_id=$(this).find('td').eq(0).text();            var id=$(this).find('td').eq(1).text();            //var score=$(this).find('td').eq(4).text();            //var score_final=parseInt(parseFloat(score)*1000*0.95);            $club=$(this).find("td").find('select').eq(0);            if ($club.length>0)            {               var club_info=$club.dropdown('get value')            }            else{               var club_info=""            }            //var club_info=$(this).find("td").find('select').eq(0).dropdown('get value');            var str_club_info=club_info.split(",");            var new_club_id=str_club_info[0];            if(old_club_id!==new_club_id && new_club_id !== "")            {                result_list.push([id,old_club_id,new_club_id]);               // alert(result_list);            }        });        $.ajax({            url:'/correct_union_result/',            type:'post',            traditional:true,            data:{'result_list':result_list,'game_no':game_no},            success:function (result) {                if(result==='True'){                    alert('修改成功');                    $('.ui.modal').modal('hide')                }                else {                    alert('修改失败')                }            }        })    }</script><script>    function check_modify() {        $('#warning_message').text('请确认修改信息，修改后记录将无法被消除');        $('#check_modify').modal('show')    }</script></div></body></html>