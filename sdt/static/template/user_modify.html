<!DOCTYPE html>{% load static %}<html lang="zh"><head>    <meta charset="UTF-8">    <title>用户信息修改</title>    <link rel="stylesheet" href="{% static 'semantic/semantic.css'%}"><script src="http://lib.baomitu.com/jquery/1.12.4/jquery.min.js"></script><script src="http://lib.baomitu.com/semantic-ui/2.2.13/semantic.min.js"></script></head><body><div id="sidebar" ></div><div class="dimmed pusher"><div class="ui labeled icon button" id="menu">		<i class="sidebar icon"></i>		导航		</div>    <div class="ui doubling stackable container" style="padding: 50px">        <div class="ui five item inverted menu">		<a class="item" id="a">出纳台</a>		<a class="item" id="b">玩家管理</a>		<a class="item" id="c">牌局管理</a>		<a class="item" id="d">实时报表</a>		<a class="item" id="e">俱乐部管理</a>		</div>        <div class="ui small modal" id="result_modal">        <h2 class="header">处理结果</h2>        <div class="content">            <p id="msg1"></p>        </div>        <div class="actions">            <button class="ui negative button" onclick="messageconfirm()">返回</button>        </div>    </div>        <div class="ui form" name="user_info" id="user_info" method="post">        <div class="fields">        <div class="field">            <label for="user_list">搜索玩家</label>        <select class="ui search selection dropdown" name="user_list" id="user_list" onchange="search()">            <i class="search link icon"></i>            <option class="item" value="">点击搜索</option>            {% for t in tb_user %}            <option class="item" value={{ t.0 }}>{{ t.7 }}</option>            {% endfor %}        </select>        </div>        <div class="field">            <label>&nbsp;</label>            <button class="ui positive button" onclick="new_user()">新增游戏ID</button>        </div>        </div>            <h4 class="ui dividing pink header">用户信息修改</h4>            <div class="two fields">                <div class="field">                    <label>游戏名称</label>                <input type="text" name="new_name" id="new_name" value={{ user_name }}>                </div>                    <div class="field">                    <label>微信名称</label>                <input type="text" name="wx_name" id="wx_name" value={{ tb_result.wx_name }}>                </div>            </div>            <div class="two fields">                <div class="field">                    <label>主账户</label>                <input type="text" name="main_account" id="main_account" readonly="true" value={{ tb_result.main_account }}>                </div>                    <div class="field">                    <label>同账户玩家</label>                <input type="text" name="account_list" id="account_list" readonly="true" value={{ tb_result.tb_account_list }}>                </div>            </div>            <div class="two fields">                <div class="field">                    <label>归属俱乐部</label>                <input type="text" name="club_list" id="club_list" readonly="true" value={{ tb_result.club_list }} >                </div>                    <div class="field">                    <label>别名</label>                <input type="text" name="remark" id="remark">                </div>            </div>            <div class="two fields">                <div class="field">                    <label>返水比例</label>                    <input type="text" name="feedback" id="feedback" value={{ tb_result.feedback }}>                </div>                <div class="field">                        <label for="feedback_type">返水模式</label>                        <select class="ui selected dropdown" id="feedback_type">                            <option value="">设置返水模式</option>                            <option value='0'>水上水下返水</option>                            <option value='1'>仅水上返水</option>                        </select>                </div>            </div>            <div class="ui hidden divider"></div>            <button class="ui button primary" onclick="modifyuser()">修改</button>            <button class="ui button negative"onclick="reset()">放弃</button>              <input type="hidden" id="user_id" value="">              <input type="hidden" id="old_name" type="text" value="">              <input type="hidden"  id="old_wx_name" type="text" value="">              <input type="hidden" id="old_remark" type="text" value="">              <input type="hidden" id="old_feedback" type="text" value="">              <input type="hidden" id="old_feedback_type" type="text" value="">        </div>      <div class="ui info message">            <div class="header">操作提示</div>            <ul class="list"></ul>                <li>玩家名称全联盟唯一，修改后全联盟生效</li>                <li>请确保在改名前原玩家名没有在未结算的牌局中</li>      </div><div class="ui modal" id="new_name_modal">    <i class="close icon"></i>    <div class="header">        <p>新增游戏ID</p>    </div>    <div class="ui content">    <div class="ui form" id="new_user_name_form">        <div class="field">            <label>玩家名称</label>            <input type="text" readonly="readonly" id="old_user_name">            <input type="text" style="display: none" id="subs_user_id">        </div>        <div class="field">            <label>新游戏ID</label>            <input type="text" id="new_user_name">        </div>        <div class="field">            <label>备注</label>            <input type="text" id="subs_remark">        </div>        <div class="field">            <label>返水比例</label>            <input type="text" name="subs_feedback" id="subs_feedback">        </div>        <div class="field">            <label for="subs_feedback_type">返水模式</label>            <select class="ui selected dropdown" id="subs_feedback_type">                <option value='0'>水上水下返水</option>                <option value='1'>仅水上返水</option>            </select>        </div>    </div>    </div>    <div class="actions">        <button class="ui positive button" onclick="add_new_user()">添加</button>        <button class="ui negative button">取消</button>    </div></div></div></div><script>	$(document).ready(function(){        $('.ui.dropdown').dropdown({            fullTextSearch:true        });		$("#sidebar").load('/loadsidebar/');        $("#b").addClass('active red item');        $("#menu").click(function(){            $('.ui.sidebar').sidebar('toggle');        })	}					 )</script><script>        $.fn.form.settings.rules.check_feedback=function (feedback) {        if(parseFloat(feedback)<=5 && parseFloat(feedback)>=0)        {            return true        }        else {            return false        }    };</script><script>    $('#user_info').form({    on:'blur',    inline:true,    fields:{        new_name:{            identifier:'new_name',            rules:[{                type:'empty',                prompt:'玩家名不能为空'            }]        },        wx_name:{            identifier: 'wx_name',            rules:[{                type:'empty',                prompt:'微信名不能为空'            }]        },        feedback: {        identifier  : 'feedback',        rules: [          {            type   : 'regExp',            value : '^(\\+)?\\d+(\\.\\d+)?$',            prompt : '请输入正数'          },            {                type: 'check_feedback',                prompt:'请输入0-5之间数字'            },            {                type:'empty',                prompt:'返水比例不能为空'            }        ]      }    }});    $('#new_user_name_form').form({    on:'blur',    inline:true,    fields:{        new_user_name:{            identifier:'new_user_name',            rules:[{                type:'empty',                prompt:'玩家名不能为空'            }]        },        subs_feedback: {        identifier  : 'subs_feedback',        rules: [          {            type   : 'regExp',            value : '^(\\+)?\\d+(\\.\\d+)?$',            prompt : '请输入正数'          },            {                type: 'check_feedback',                prompt:'请输入0-5之间数字'            },            {                type:'empty',                prompt:'返水比例不能为空'            }        ]      }    }});</script><script>    function search() {        var user_id = $('#user_list').dropdown('get value');        $.ajax({            url : '/searchUser/',            type : 'post',            datatype: "json",            data:{'user_id': user_id},            success:function (result) {                if(result!="False")                {                    var dic=[];                    $.each(JSON.parse(result), function (key, value) {                        dic[key]=value;                        //alert(dic[key]);                    })                    $('#new_name').val(dic['user_name']);                    $('#wx_name').val(dic['wx_name']);                    $('#main_account').val(dic['main_account']);                    $('#account_list').val(dic['tb_account_list']);                    $('#club_list').val(dic['club_list']);                    $('#remark').val(dic['remark']);                    $('#user_id').val(dic['user_id']);                    $('#old_name').val(dic['user_name']);                    $('#old_wx_name').val(dic['user_name']);                    $('#old_remark').val(dic['remark']);                    $('#feedback').val(dic['feedback']);                    $('#old_feedback').val(dic['feedback']);                    var feeback_type=dic['feedback_type'];                    $('#old_feedback_type').val(feeback_type);                    if(feeback_type===0){                        var feeback_text='水上水下返水'                    }                    else {                        var feeback_text='仅水上退水'                    }                    $('#feedback_type').dropdown(                        'set value',feeback_type                    );                    $('#feedback_type').dropdown(                        'set text',feeback_text                    )                }            }        })    }</script><script>    function modifyuser() {            $.ajaxSetup({async: true});            var new_name=$.trim($('#new_name').val());            var user_id=$.trim($('#user_id').val());            var wx_name=$.trim($('#wx_name').val());            var remark=$.trim($('#remark').val());            var old_name=$('#old_name').val();            var old_wx_name=$('#old_wx_name').val();            var old_remark=$('#old_remark').val();            var old_feedback=$('#old_feedback').val();            var feedback=$('#feedback').val();            var old_feedback_type=$('#old_feedback_type').val();            var feedback_type=$('#feedback_type').dropdown('get value');            var pp=(new_name==old_name && wx_name==old_wx_name && remark==old_remark && old_feedback==feedback && feedback_type==old_feedback_type);            if (pp)            {                $('#msg1').text("没有任何修改");                $('#result_modal').modal('show');            }            else{                $.ajax({                    type:'post',                    url:'/modifyUserInfo/',                    data:{'user_name': new_name, 'user_id':user_id, 'wx_name':wx_name,                        'remark':remark, 'old_name':old_name,'old_wx_name':old_wx_name,'old_remark':old_remark,'feedback':feedback,'feedback_type':feedback_type},                    success: function (result) {                        if (result=="玩家名字已存在")                        {                            $('#msg1').text("玩家名字已存在");                            $('#result_modal').modal('show');                        }                        else if(result!="False"){                            $('#msg1').text("修改成功");                            $('#result_modal').modal('show');                        }                    }                })            }    }            function messageconfirm() {            location.reload();        }</script><script>    function reset() {        location.reload();    }</script><script>    function add_new_user() {        var flag=$('#new_user_name_form').form('is valid');        if(flag===true) {            var old_user_name = $('#user_list').dropdown('get text');            var user_id = $('#user_list').dropdown('get value');            var new_user_name = $.trim($('#new_user_name').val());            var remark = $.trim($('#subs_remark').val());            var feedback=$.trim($('#subs_feedback').val());            var feedback_type=$('#subs_feedback_type').dropdown('get value');            $.ajax({                url:'/checkuser/',                type:'post',                data:{'user_name':new_user_name},                success:function (result) {                    var flag=result;                    switch (flag)                    {                        case "1":                            alert('俱乐部存在同名玩家，请在账户中合并');                            break;                        default:                            $.ajax({                                url: '/add_user_exist_account/',                                type: 'post',                                data: {                                    'old_user_name': old_user_name,                                    'user_id': user_id,                                    'new_user_name': new_user_name,                                    'remark': remark,                                    'feedback':feedback,                                    'feedback_type':feedback_type                                },                                success: function (result) {                                    if (result === 'True') {                                        alert('添加成功');                                        $('#new_user_name').val("");                                        $('#subs_remark').val("");                                        search();                                    }                                    else {                                        alert('添加失败')                                    }                                }                            });                            $('#new_name_modal').modal('hide')                                    }                }            });        }        else{            alert('请填写完整信息')        }    }</script><script>    function new_user() {        var old_user_name = $('#user_list').dropdown('get text');        $('#old_user_name').val(old_user_name);        $('#subs_user_id').val(user_id);        $('#new_name_modal').modal('show')    }</script></body></html>